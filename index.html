    <!DOCTYPE html>
    <html lang="pt-BR">
    <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J626WB5LLP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-J626WB5LLP'); // ID do Google Analytics correto
    </script>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Coliseum Shop</title>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
      <style>
        body { font-family: 'Montserrat', Arial, sans-serif; margin: 0; background: #fff; color: #222;}
        header { background: #fff; border-bottom: 2px solid #b8862b; }
        .header-topo { display: flex; align-items: center; justify-content: space-between; max-width: 1100px; margin: 0 auto; padding: 16px 8px 8px 8px;}
        .logo-img { width: 120px; border-radius: 14px; background: #111; box-shadow:0 2px 20px #cbb;}
        .header-title { font-size: 2.3em; font-weight: bold; color: #8c1212; letter-spacing: 1px; margin-left: 18px;}
        .header-banner { width: 100%; max-height: 280px; object-fit: cover; border-radius: 18px; box-shadow:0 2px 32px #cbb8;}
        nav { display: flex; justify-content: flex-start; gap: 15px; margin-top: 25px; margin-bottom: 6px; overflow-x: auto; padding-bottom: 4px; -webkit-overflow-scrolling: touch;}
        nav::-webkit-scrollbar {display: none;}
        nav button { flex: 0 0 auto; padding: 13px 28px; background: #fff; color: #8c1212; border: 2.5px solid #b8862b; cursor: pointer; border-radius: 13px; font-weight: bold; font-size: 1.09em; transition: all .3s; }
        nav button.active, nav button:hover { background: #8c1212; color: #fff; border-color: #b8862b; box-shadow: 0 2px 6px #b8862b44; }
        main { padding: 2em 1em 1em 1em; max-width: 1100px; margin: 0 auto; }
        .prod-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(270px,1fr)); gap: 32px; }
        .product-card { background: #fff; border-radius: 15px; box-shadow: 0 2px 24px #b8862b1c; padding: 20px 18px 14px 18px; display: flex; flex-direction: column; align-items: center; transition: box-shadow 0.2s, transform .18s;}
        .product-card:hover { box-shadow: 0 8px 36px #b8862b39; transform: translateY(-4px) scale(1.01);}
        .prod-img { width: 140px; height: 140px; border-radius: 13px; object-fit: cover; border: 2px solid #b8862b; background: #f9f7f3; cursor:pointer;}
        .prod-nome { font-size: 1.17em; color: #8c1212; font-weight: bold; margin: 15px 0 7px 0;}
        .prod-preco { font-size: 1.07em; color: #b8862b; font-weight: bold;}
        .star-rating { color: #ffb800; font-size: 1.09em; margin-bottom: 4px;}
        .product-controls { margin-top: 13px; width: 100%; display: flex; justify-content: center; align-items: center; gap: 8px;}
        .quantity-selector { display: flex; align-items: center; gap: 8px;}
        .quantity-btn { background: #fff; border: 2px solid #b8862b; color: #8c1212; font-weight: bold; border-radius: 7px; width: 36px; height: 36px; cursor: pointer; font-size: 1.25em;}
        .quantity-btn[disabled] { opacity: .5; cursor: not-allowed;}
        .quantity-btn:hover:not([disabled]) { background: #b8862b; color: #fff;}
        .add-cart-btn { background: #b8862b; color: white; border: none; border-radius: 8px; padding: 10px 20px; font-weight: bold; cursor: pointer; font-size: 1.08em;}
        .add-cart-btn[disabled] { opacity: .5; cursor: not-allowed;}
        .add-cart-btn:active { background: #8c1212;}
        .empty-cart { text-align: center; color: #888; padding: 20px 0; font-style: italic;}
        #cart-button { position: fixed; bottom: 28px; right: 28px; background: #8c1212; color: white; padding: 16px 27px; border-radius: 50px; cursor: pointer; border: none; font-weight: bold; box-shadow: 0 4px 15px #b8862b33; z-index: 1000; display: flex; align-items: center; gap: 8px; font-size: 1.1em; transition: transform 0.2s;}
        #cart-button:hover { transform: scale(1.06);}
        #cart { position: fixed; right: 28px; bottom: 96px; background: white; border: 2px solid #b8862b; padding: 1.5em; width: 360px; max-height: 65vh; overflow-y: auto; border-radius: 14px; box-shadow: 0 8px 28px #b8862b39; z-index: 999;}
        .hidden { display: none;}
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;}
        .cart-item-remove { background: #8c1212; color: white; border: none; padding: 6px 12px; border-radius: 7px; cursor: pointer; font-size: 1em;}
        .cart-item-remove:hover { background: #b8862b;}
        .action-button { padding: 13px; width: 100%; border-radius: 9px; font-weight: bold; font-size: 1em; cursor: pointer; transition: all 0.2s; border: none;}
        .confirm-button { background: #4CAF50; color: white;}
        .confirm-button:hover { background: #388e3c;}
        .cancel-button { background: #8c1212; color: white; margin-top: 10px;}
        .cancel-button:hover { background: #b8862b;}
        /* Modal */
        #modal-img-bg {display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.75);z-index:9999;align-items:center;justify-content:center;}
        #modal-img-close {position:absolute;top:18px;right:32px;font-size:2.5em;color:#fff;cursor:pointer;font-weight:bold;z-index:10000;}
        #modal-img-view {max-width:90vw;max-height:80vh;border-radius:17px;box-shadow:0 8px 40px #000a;}
        /* Modal de detalhes */
        #modal-produto-bg {display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.72);z-index:10000;align-items:center;justify-content:center;}
        #modal-produto-card {background:#fff; border-radius:19px; padding:40px 28px 32px 28px; max-width: 370px; box-shadow: 0 8px 38px #b8862b77; position:relative; text-align:center;}
        #modal-produto-card img { width:180px; height:180px; border-radius:14px; object-fit:cover; border:2px solid #b8862b;}
        #modal-produto-card .prod-nome {font-size:1.3em;}
        #modal-produto-card .star-rating {margin-bottom:2px;}
        #modal-produto-card .prod-preco {font-size:1.13em;}
        #modal-produto-close {position:absolute;top:12px;right:18px;font-size:2.2em;color:#8c1212;cursor:pointer;font-weight:bold;}
        /* Loading spinner */
        .fa-spinner { margin-right: 8px; }
        .action-button:disabled { opacity: 0.7; cursor: not-allowed; }
        /* Email input */
        .email-input {
          width: 100%;
          padding: 12px;
          margin: 15px 0;
          border: 2px solid #b8862b;
          border-radius: 8px;
          font-size: 1em;
        }
        .email-input:focus {
          outline: none;
          border-color: #8c1212;
        }
        /* Payment status */
        .payment-status {
          padding: 15px;
          margin: 15px 0;
          border-radius: 8px;
          text-align: center;
          font-weight: bold;
        }
        .payment-success {
          background: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
        }
        .payment-failure {
          background: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
        }
        .payment-pending {
          background: #fff3cd;
          color: #856404;
          border: 1px solid #ffeeba;
        }
        @media (max-width: 900px) {
          .header-topo { flex-direction: column; gap:10px;}
          .header-banner {max-height:160px;}
          main {padding: 1em 0.2em;}
          #cart {width:97vw; left:1vw;}
        }
        @media (max-width: 600px) {
          .header-title { font-size: 1.45em; margin-left: 0;}
          .header-topo { flex-direction: column; gap:7px; }
          nav { gap: 8px; margin-top:12px; }
          nav button { font-size: 0.99em; padding: 10px 18px;}
          .header-banner {max-height:120px; border-radius:12px;}
          main { padding: 8px 0.1em; }
          .prod-img { width: 100px; height: 100px;}
          #cart { width: 98vw; left: 1vw;}
          #cart-button { bottom: 20px; right: 20px; padding: 12px 20px; font-size: 1em; }
        }
        footer {background: #f8f5f0; color: #8c1212; text-align:center; font-size: 1.08em; padding: 30px 10px 18px 10px; border-top: 2px solid #b8862b;}
        .footer-row {margin-bottom: 8px;}
        .footer-social a {display:inline-block;margin:0 8px; color:#b8862b; font-size:1.7em; transition:.18s;}
        .footer-social a:hover {color:#8c1212;}
        .footer-handles {font-size: 1em; color: #8c1212; margin: 10px 0 5px 0;}
        #whatsapp-float {
          position: fixed; bottom: 24px; left: 24px; background: #25d366; color: #fff;
          width: 62px; height: 62px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
          font-size: 2.4em; box-shadow:0 4px 16px #25d36655; z-index: 1100; transition:background .2s;
        }
        #whatsapp-float:hover { background: #128c7e; }
      </style>
    </head>
    <body>
      <header>
        <div class="header-topo">
          <img src="logo-coliseum.jpg" class="logo-img" alt="Coliseum Shop Logo">
          <div class="header-title">Coliseum Shop</div>
        </div>
        <img src="A_digital_composite_promotional_banner_showcases_f.png" alt="Banner Coliseum Shop Artes Marciais" class="header-banner">
        <nav id="menu-nav">
          <button data-category="vestuario" class="active">Vestu√°rio</button>
          <button data-category="muaythai">Muay Thai/Boxe</button>
          <button data-category="jiujitsu">Jiu-jitsu/Jud√¥</button>
          <button data-category="acessorios">Acess√≥rios</button>
        </nav>
        <div id="submenu-muaythai" style="display:none; text-align:center; margin-top:5px;">
          <button class="sub-btn" data-sub="luvas" style="margin:2px 7px; padding:8px 25px; border-radius:8px; border:1.5px solid #b8862b; background:#fff; color:#8c1212; font-weight:bold; cursor:pointer;">Luvas</button>
          <button class="sub-btn" data-sub="caneleiras" style="margin:2px 7px; padding:8px 25px; border-radius:8px; border:1.5px solid #b8862b; background:#fff; color:#8c1212; font-weight:bold; cursor:pointer;">Caneleiras</button>
        </div>
      </header>

      <main>
        <!-- Mostrar status do pagamento se houver par√¢metro na URL -->
        <div id="payment-status" class="hidden"></div>
        
        <div class="prod-grid" id="product-list"></div>
      </main>

      <div id="cart-button" onclick="openCart()">
        üõí Carrinho (<span id="cart-count">0</span>)
      </div>

      <div id="cart" class="hidden">
        <h2 style="margin-top: 0; color: #8c1212;">Seu Pedido</h2>
        <div id="cart-items"></div>
        <div id="cart-error" class="error"></div>
        <div id="total">Total: R$ 0,00</div>
        
        <!-- Campo de e-mail obrigat√≥rio -->
        <input type="email" id="customer-email" class="email-input" 
               placeholder="Seu e-mail para receber a confirma√ß√£o" required>
        
        <button onclick="sendWhatsApp()" class="action-button confirm-button" style="margin-bottom:7px;">
          Finalizar Pedido no WhatsApp
        </button>
        <button onclick="pagarComMercadoPago()" class="action-button" style="background:#009ee3;margin-bottom:7px;">
          <i class="fa-brands fa-pix"></i> Pagar com Mercado Pago
        </button>
        <button onclick="closeCart()" class="action-button cancel-button">Fechar Carrinho</button>
      </div>

      <!-- Modal para imagem grande -->
      <div id="modal-img-bg" style="display:none; align-items:center; justify-content:center;">
        <span id="modal-img-close">&times;</span>
        <img id="modal-img-view" src="">
      </div>
      
      <!-- Modal de detalhes do produto -->
      <div id="modal-produto-bg" style="display:none; align-items:center; justify-content:center;">
        <div id="modal-produto-card"></div>
      </div>

      <footer>
        <div class="footer-row"><b>Av. Chefic Khoury S/N, Ant√¥nio Guilhermino, Juazeiro-BA</b></div>
        <div class="footer-row footer-social">
          <a href="https://wa.me/5574981180566" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
          <a href="https://www.instagram.com/flavio_e_silva/" target="_blank" title="@flavio_e_silva"><i class="fab fa-instagram"></i></a>
          <a href="https://www.instagram.com/coliseum_fight_college/" target="_blank" title="@coliseum_fight_college"><i class="fab fa-instagram"></i></a>
        </div>
        <div class="footer-handles">
          <span>@flavio_e_silva &nbsp; | &nbsp; @coliseum_fight_college</span>
        </div>
        <div class="footer-row">¬© Coliseum Shop. Todos os direitos reservados.</div>
      </footer>

      <!-- Mercado Pago SDK -->
      <script src="https://sdk.mercadopago.com/js/v2"></script>
      <script>
        // Configura√ß√£o do Mercado Pago
        const mp = new MercadoPago('APP_USR-2cf8bb64-1d8a-4bb2-802b-6f2ef8331d61', { 
          locale: 'pt-BR'
        });

        let produtos = [];
        let cart = [];
        let selectedQty = {};

        // Verificar status de pagamento na URL
        function checkPaymentStatus() {
          const urlParams = new URLSearchParams(window.location.search);
          const paymentStatus = urlParams.get('payment');
          const statusElement = document.getElementById('payment-status');
          
          if (paymentStatus === 'success') {
            statusElement.className = 'payment-status payment-success';
            statusElement.innerHTML = '‚úÖ Pagamento aprovado! Seu pedido est√° sendo processado.';
            statusElement.classList.remove('hidden');
            cart = [];
            updateCartIcon();
          } else if (paymentStatus === 'failure') {
            statusElement.className = 'payment-status payment-failure';
            statusElement.innerHTML = '‚ùå Pagamento recusado. Por favor, tente novamente.';
            statusElement.classList.remove('hidden');
          } else if (paymentStatus === 'pending') {
            statusElement.className = 'payment-status payment-pending';
            statusElement.innerHTML = '‚è≥ Pagamento pendente. Aguarde confirma√ß√£o.';
            statusElement.classList.remove('hidden');
          }
        }

        function renderMenuCategorias() {
          document.querySelectorAll('nav button').forEach(btn => {
            btn.onclick = function() {
              filterMenu(this.getAttribute('data-category'));
              toggleSubmenuMuaythai(this.getAttribute('data-category') === 'muaythai');
            }
          });
        }

        function toggleSubmenuMuaythai(show) {
          document.getElementById('submenu-muaythai').style.display = show ? 'block' : 'none';
          if(show) {
            document.querySelectorAll('#submenu-muaythai .sub-btn').forEach(b => {
              b.style.background = '#fff'; b.style.color = '#8c1212';
            });
            let btn = document.querySelector('#submenu-muaythai .sub-btn[data-sub="luvas"]');
            if(btn) {
              btn.style.background = '#b8862b'; btn.style.color = '#fff';
              filterMenu('muaythai', 'luvas');
            }
          }
        }

        function filterMenu(category, sub = null) {
          let filteredProducts = produtos.filter(p =>
            p.categoria === category && ['vestuario','muaythai','jiujitsu','acessorios'].includes(p.categoria)
          );
          if(category === 'muaythai' && sub) {
            filteredProducts = filteredProducts.filter(p => (p.subcategoria||'').toLowerCase() === sub);
          }
          if (filteredProducts.length === 0) {
            document.getElementById('product-list').innerHTML = '<p class="empty-cart">Nenhum produto dispon√≠vel nesta categoria no momento.</p>';
            return;
          }
          const list = document.getElementById('product-list');
          list.innerHTML = '';
          filteredProducts.forEach(p => {
            if (selectedQty[p.id] === undefined) selectedQty[p.id] = 1;
            if (p.estoque !== undefined && selectedQty[p.id] > p.estoque) selectedQty[p.id] = p.estoque || 1;
            if (p.estoque === 0) selectedQty[p.id] = 1;
            const estrelas = '<span class="star-rating">‚òÖ ‚òÖ ‚òÖ ‚òÖ ‚òÖ</span>';
            const esgotado = (p.estoque !== undefined && p.estoque <= 0);
            const div = document.createElement('div');
            div.className = 'product-card';
            div.innerHTML = `
              <img src="${p.imgurl||'https://placehold.co/140x140?text=+'}" class="prod-img" alt="${p.nome}">
              <div class="prod-nome">${p.nome}</div>
              <div class="prod-preco">R$ ${p.preco.toFixed(2).replace('.', ',')}</div>
              ${estrelas}
              <div class="product-controls">
                <div class="quantity-selector">
                  <button class="quantity-btn" onclick="changeQty('${p.id}', -1)" ${esgotado || selectedQty[p.id]<=1 ? 'disabled' : ''}>-</button>
                  <span class="quantity-value" id="qty-value-${p.id}">${selectedQty[p.id]}</span>
                  <button class="quantity-btn" onclick="changeQty('${p.id}', 1)" ${esgotado || selectedQty[p.id]>=p.estoque ? 'disabled' : ''}>+</button>
                </div>
                ${esgotado
                  ? `<span style="color:#b01212;font-weight:bold;padding:8px 15px;">Esgotado</span>`
                  : `<button class="add-cart-btn" onclick="addToCart('${p.id}')" ${selectedQty[p.id]>p.estoque ? 'disabled' : ''}>Adicionar</button>`
                }
                <button class="add-cart-btn" style="background:#b8862b99;" onclick="openModalProduto('${p.id}')">Detalhes</button>
              </div>
              <div class="prod-estoque" style="margin-top:7px;color:${esgotado ? '#b01212' : '#4CAF50'};font-size:0.96em;">
                ${esgotado ? 'Esgotado' : 'Estoque: ' + (p.estoque ?? '--')}
              </div>
            `;
            list.appendChild(div);
          });
        }

        window.changeQty = function(id, delta) {
          const p = produtos.find(pr => pr.id === id);
          if (!p || p.estoque <= 0) return;
          selectedQty[id] = Math.max(1, Math.min(p.estoque, (selectedQty[id] || 1) + delta));
          document.getElementById('qty-value-' + id).innerText = selectedQty[id];
          filterMenu(p.categoria);
        }

        window.addToCart = function(id) {
          const item = produtos.find(p => p.id === id);
          if (!item) return;
          const qty = selectedQty[id] || 1;
          if (item.estoque !== undefined) {
            let inCart = 0;
            const cartItem = cart.find(p => p.id === id);
            if (cartItem) inCart = cartItem.qty;
            if (qty + inCart > item.estoque) {
              // Usar modal em vez de alert()
              alert('Estoque insuficiente.'); // Manter alert() por enquanto, mas ideal √© usar modal
              return;
            }
          }
          const existing = cart.find(p => p.id === id);
          if (existing) {
            existing.qty += qty;
          } else {
            cart.push({ ...item, qty: qty });
          }
          updateCartIcon();
          safeRenderCart();
          showMsgOkCarrinho();
        }

        function updateCartIcon() {
          const cartCount = document.getElementById('cart-count');
          if (cartCount) {
            cartCount.innerText = cart.reduce((a, b) => a + b.qty, 0);
          }
        }

        function openCart() {
          document.getElementById('cart').classList.remove('hidden');
          safeRenderCart();
        }

        function closeCart() {
          document.getElementById('cart').classList.add('hidden');
          const errorElement = document.getElementById('cart-error');
          if (errorElement) errorElement.innerText = '';
        }

        function removeItemCompletely(id) {
          cart = cart.filter(item => item.id !== id);
          updateCartIcon();
          safeRenderCart();
        }

        function safeRenderCart() {
          const cartItems = document.getElementById('cart-items');
          if (!cartItems) return;
          cartItems.innerHTML = '';
          if (cart.length === 0) {
            cartItems.innerHTML = '<p class="empty-cart">Seu carrinho est√° vazio</p>';
            document.getElementById('total').innerText = 'Total: R$ 0,00';
            return;
          }
          let subtotal = 0;
          cart.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'cart-item';
            itemDiv.innerHTML = `
              <div>
                <strong>${item.qty}x</strong> ${item.nome}
                <div>R$ ${(item.qty * item.preco).toFixed(2).replace('.', ',')}</div>
              </div>
              <button onclick="removeItemCompletely('${item.id}')" class="cart-item-remove">Remover</button>
            `;
            cartItems.appendChild(itemDiv);
            subtotal += item.qty * item.preco;
          });
          document.getElementById('total').innerHTML = `<div style="margin-top: 10px; font-size: 1.2em;">Total: R$ ${subtotal.toFixed(2).replace('.', ',')}</div>`;
        }

        function sendWhatsApp() {
          if (cart.length === 0) {
            document.getElementById('cart-error').innerText = 'Seu carrinho est√° vazio. Adicione itens antes de finalizar.';
            return;
          }
          
          const customerEmail = document.getElementById('customer-email').value;
          if (!customerEmail) {
            document.getElementById('cart-error').innerText = 'Por favor, informe seu e-mail.';
            return;
          }

          const subtotal = cart.reduce((a, b) => a + b.qty * b.preco, 0);
          let itens = cart.map(item =>
            `${item.qty}x ${item.nome} - R$ ${(item.qty * item.preco).toFixed(2).replace('.', ',')}`
          ).join('\n');
          
          let message = `*PEDIDO - COLISEUM SHOP*\n\n`;
          message += `*Itens:*\n${itens}\n\n`;
          message += `*Total: R$ ${subtotal.toFixed(2).replace('.', ',')}*\n\n`;
          message += `*E-mail para contato:* ${customerEmail}\n\n`;
          message += `*Desejo finalizar minha compra!*`;
          
          const encodedMessage = encodeURIComponent(message);
          window.open(`https://wa.me/5574981180566?text=${encodedMessage}`, '_blank');
        }

        // Integra√ß√£o com Mercado Pago
        async function pagarComMercadoPago() {
          if (cart.length === 0) {
            document.getElementById('cart-error').innerText = 'Seu carrinho est√° vazio. Adicione itens antes de finalizar.';
            return;
          }

          const customerEmail = document.getElementById('customer-email').value;
          if (!customerEmail) {
            document.getElementById('cart-error').innerText = 'Por favor, informe seu e-mail.';
            return;
          }

          // Mostrar loading
          const mpButton = document.querySelector('.action-button[style*="background:#009ee3"]');
          const originalText = mpButton.innerHTML;
          mpButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
          mpButton.disabled = true;

          try {
            const itemsToSend = cart.map(item => ({
              id: item.id,
              name: item.nome,
              price: parseFloat(item.preco),
              quantity: parseInt(item.qty),
              description: item.descricao || '',
              imgurl: item.imgurl || ''
            }));

            // ESTE URL √â CR√çTICO! SUBSTITUA PELO SEU DOM√çNIO Vercel AP√ìS O DEPLOY INICIAL DO BACKEND.
            // Exemplo: 'https://SEU-DOMINIO-DO-VERCEL.vercel.app/api/create_preference'
            const backendUrl = 'https://coliseumshop-backend.vercel.app/api/create_preference'; // Agora com o seu URL correto!

            // --- LOGS DE DEPURACAO CRUCIAIS ---
            console.log('--- A tentar chamar a API do backend ---');
            console.log('URL da API:', backendUrl);
            console.log('M√©todo:', 'POST');
            console.log('Headers:', { 'Content-Type': 'application/json' });
            console.log('Corpo da requisi√ß√£o (JSON):', JSON.stringify({
                cartItems: itemsToSend,
                payerEmail: customerEmail
            }, null, 2));
            // --- FIM DOS LOGS DE DEPURACAO ---

            const response = await fetch(backendUrl, {
              method: 'POST',
              headers: { 
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                cartItems: itemsToSend,
                payerEmail: customerEmail
              })
            });

            if (!response.ok) {
              // Tentar ler o erro do backend se a resposta n√£o for OK
              const errorData = await response.json().catch(() => ({ error: 'Erro desconhecido ou resposta n√£o JSON.' }));
              throw new Error(`Erro na API (${response.status}): ${errorData.error || response.statusText}`);
            }

            const data = await response.json();
            
            if (data.init_point) {
              window.location.href = data.init_point;
            } else {
              throw new Error('Link de pagamento n√£o gerado');
            }
          } catch (error) {
            console.error('Erro Mercado Pago (Frontend):', error);
            document.getElementById('cart-error').innerText = 'Erro: ' + error.message;
            mpButton.innerHTML = originalText;
            mpButton.disabled = false;
          }
        }

        // Modal para imagem grande
        document.body.addEventListener('click', function(e) {
          if (e.target.classList.contains('prod-img')) {
            document.getElementById('modal-img-view').src = e.target.src;
            document.getElementById('modal-img-bg').style.display = 'flex';
          }
          if (e.target.id === 'modal-img-bg' || e.target.id === 'modal-img-close') {
            document.getElementById('modal-img-bg').style.display = 'none';
          }
        });

        // Modal de detalhes do produto
        window.openModalProduto = function(id) {
          const prod = produtos.find(p => p.id === id);
          if (!prod) return;
          document.getElementById('modal-produto-card').innerHTML = `
            <span id="modal-produto-close">&times;</span>
            <img src="${prod.imgurl || 'https://placehold.co/140x140?text=+'}" alt="${prod.nome}">
            <div class="prod-nome">${prod.nome}</div>
            <div class="prod-preco">R$ ${prod.preco.toFixed(2).replace('.', ',')}</div>
            <div class="star-rating">‚òÖ ‚òÖ ‚òÖ ‚òÖ ‚òÖ</div>
            <div style="margin:15px 0 10px 0;">${prod.descricao || ''}</div>
          `;
          document.getElementById('modal-produto-bg').style.display = 'flex';
        }
        
        document.body.addEventListener('click', function(e){
          if(e.target.id === 'modal-produto-bg' || e.target.id === 'modal-produto-close') {
            document.getElementById('modal-produto-bg').style.display = 'none';
          }
        });

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
          checkPaymentStatus();
          renderMenuCategorias();
          updateCartIcon();
          
          document.querySelectorAll('#submenu-muaythai .sub-btn').forEach(btn => {
            btn.onclick = function() {
              document.querySelectorAll('#submenu-muaythai .sub-btn').forEach(b => {
                b.style.background = '#fff'; b.style.color = '#8c1212';
              });
              this.style.background = '#b8862b'; this.style.color = '#fff';
              filterMenu('muaythai', this.dataset.sub);
            }
          });

          // TODO: IMPLEMENTAR A BUSCA DE PRODUTOS DO FIREBASE FIRESTORE VIA BACKEND
          // Por enquanto, mantenha os produtos hardcoded para que a loja continue funcionando
          // Futuramente, esta se√ß√£o ser√° substitu√≠da por uma chamada √† API de produtos do seu backend
           produtos = [
            // Vestu√°rio
            { id: 'prod1', nome: 'Camiseta de Treino "For√ßa Bruta"', preco: 69.90, categoria: 'vestuario', estoque: 20, imgurl: 'https://placehold.co/140x140/b8862b/ffffff?text=Camiseta', descricao: 'Camiseta de alta performance para treinos intensos, com tecnologia que absorve o suor.' },
            { id: 'prod2', nome: 'Shorts Muay Thai "Impacto"', preco: 89.90, categoria: 'vestuario', estoque: 15, imgurl: 'https://placehold.co/140x140/8c1212/ffffff?text=Shorts', descricao: 'Shorts leves e resistentes, ideais para Muay Thai e outras artes marciais, proporcionando liberdade de movimento.' },
            // Muay Thai/Boxe
            { id: 'prod3', nome: 'Luvas Boxe Profissional 12oz', preco: 299.00, categoria: 'muaythai', subcategoria: 'luvas', estoque: 8, imgurl: 'https://placehold.co/140x140/b8862b/ffffff?text=Luvas', descricao: 'Luvas de boxe de couro de alta qualidade, 12 on√ßas, para treinos e sparring.' },
            { id: 'prod4', nome: 'Caneleira Pro "Defesa Total"', preco: 189.50, categoria: 'muaythai', subcategoria: 'caneleiras', estoque: 10, imgurl: 'https://placehold.co/140x140/8c1212/ffffff?text=Caneleira', descricao: 'Caneleiras com prote√ß√£o refor√ßada, ajuste confort√°vel para treinos de Muay Thai e Kickboxing.' },
            // Jiu-jitsu/Jud√¥
            { id: 'prod5', nome: 'Kimono Jiu-jitsu Preto A2', preco: 399.00, categoria: 'jiujitsu', estoque: 7, imgurl: 'https://placehold.co/140x140/b8862b/ffffff?text=Kimono', descricao: 'Kimono de Jiu-jitsu resistente, tamanho A2, ideal para treinos e competi√ß√µes.' },
            { id: 'prod6', nome: 'Faixa Jiu-jitsu Branca', preco: 35.00, categoria: 'jiujitsu', estoque: 30, imgurl: 'https://placehold.co/140x140/8c1212/ffffff?text=Faixa', descricao: 'Faixa branca para Jiu-jitsu, 100% algod√£o, dur√°vel e de alta qualidade.' },
            // Acess√≥rios
            { id: 'prod7', nome: 'Protetor Bucal Gel Fit', preco: 49.90, categoria: 'acessorios', estoque: 25, imgurl: 'https://placehold.co/140x140/b8862b/ffffff?text=Bucal', descricao: 'Protetor bucal mold√°vel, oferece m√°xima prote√ß√£o e conforto durante os treinos.' },
            { id: 'prod8', nome: 'Bandagem El√°stica 3m', preco: 29.00, categoria: 'acessorios', estoque: 50, imgurl: 'https://placehold.co/140x140/8c1212/ffffff?text=Bandagem', descricao: 'Bandagem el√°stica de 3 metros, ideal para proteger as m√£os e punhos em treinos de boxe e muay thai.' }
          ];
          const activeBtn = document.querySelector('nav button.active');
          const categoria = activeBtn ? activeBtn.getAttribute('data-category') : 'vestuario';
          filterMenu(categoria);
        });

        function showMsgOkCarrinho() {
          const msg = document.getElementById('msg-ok-carrinho');
          if(msg){
            msg.style.display = 'block';
            setTimeout(()=>{ msg.style.display = 'none'; }, 1100);
          }
        }
      </script>

      <a href="https://wa.me/5574981180566" target="_blank" id="whatsapp-float" title="Fale conosco no WhatsApp">
        <i class="fab fa-whatsapp"></i>
      </a>
      <div id="msg-ok-carrinho" style="display:none;position:fixed;bottom:100px;right:30px;z-index:2000;background:#4CAF50;color:#fff;padding:16px 30px;border-radius:14px;font-weight:bold;box-shadow:0 2px 16px #2228;">Adicionado ao carrinho!</div>
    </body>
    </html>
    